<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>神戸市バス 系統表示（地図検索）</title>
<style>
  body {
    background-color: #e6f5e6;
    font-family: "Hiragino Kaku Gothic ProN", sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* 地図エリアのスタイル */
  .map-scroll-container {
    width: 100%;
    height: 50vh; /* 画面の半分の高さ */
    overflow: auto; /* スクロール可能にする */
    background: #ccc;
    position: relative;
    border-bottom: 4px solid #8bc48b;
  }

  .map-wrapper {
    position: relative;
    width: 1500px; /* 画像の大きさに合わせて調整（拡大して見やすくするため） */
    margin: 0 auto;
  }

  .map-image {
    width: 100%;
    display: block;
  }

  /* 地図上のピン（ボタン）のスタイル */
  .map-pin {
    position: absolute;
    width: 24px;
    height: 24px;
    background-color: red;
    border: 2px solid white;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    transform: translate(-50%, -50%); /* 中心を座標に合わせる */
    z-index: 10;
    animation: pulse 2s infinite;
  }

  .map-pin:hover, .map-pin.active {
    background-color: #ffcc00;
    transform: translate(-50%, -50%) scale(1.3);
  }

  /* ピンのラベル（ホバー時に出る名前） */
  .map-pin::after {
    content: attr(data-name);
    position: absolute;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    font-weight: bold;
    color: #333;
  }

  .map-pin:hover::after, .map-pin.active::after {
    opacity: 1;
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
  }

  /* 操作パネル */
  .selector-container {
    background: #ffffffd5;
    padding: 10px;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    z-index: 20;
  }

  .current-stop-display {
    font-size: 16px;
    font-weight: bold;
    color: #d32f2f;
    margin-bottom: 8px;
    min-height: 24px;
  }

  .selectors-row {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
  }

  select, button {
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid #8bc48b;
    font-size: 16px;
    width: 180px;
  }

  button {
    background-color: #8bc48b;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover {
    background-color: #6ba86b;
  }

  button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }

  iframe {
    flex: 1;
    width: 100%;
    border: none;
    background: white;
  }

  @media (max-width: 600px) {
    .selectors-row {
      flex-direction: column;
      align-items: center;
    }
    select, button {
      width: 90%;
    }
    .map-scroll-container {
      height: 40vh;
    }
  }
</style>
</head>
<body>

<!-- 地図エリア -->
<div class="map-scroll-container">
  <div class="map-wrapper">
    <!-- ↓↓↓ 画像ファイル名をここに指定してください ↓↓↓ -->
    <img src="map.jpg" alt="路線図" class="map-image">
    
    <!-- 
      ピンの位置設定:
      top: 上からの位置(%), left: 左からの位置(%) 
      画像に合わせて調整してください。
    -->
    <div class="map-pin" style="top: 75%; left: 35%;" data-stop="今出在家"></div>
    <div class="map-pin" style="top: 60%; left: 38%;" data-stop="夢野町3丁目"></div>
    <div class="map-pin" style="top: 65%; left: 25%;" data-stop="宮川町9丁目"></div>
    <div class="map-pin" style="top: 55%; left: 60%;" data-stop="中山手3丁目(神戸北野ノスタ)"></div>
    <div class="map-pin" style="top: 70%; left: 15%;" data-stop="鷹取団地前"></div>
    <div class="map-pin" style="top: 68%; left: 20%;" data-stop="育英高校前"></div>
    <div class="map-pin" style="top: 60%; left: 65%;" data-stop="三宮駅前"></div>
  </div>
</div>

<!-- 操作・表示エリア -->
<div class="selector-container">
  <div id="selectedStopName" class="current-stop-display">地図上の赤いピンを押してバス停を選択</div>

  <div class="selectors-row">
    <!-- バス停選択プルダウンは削除 -->

    <select id="direction" disabled>
      <option value="">方面を選択してください</option>
    </select>

    <select id="line" disabled>
      <option value="">系統</option>
    </select>

    <button id="showBtn">表示</button>
  </div>
</div>

<iframe id="resultFrame"></iframe>

<script>
// データ定義
const data = {
  "今出在家": {
    "新開地方面": {
      "3系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0341&directionId=kobe0004",
      "9系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0341&directionId=kobe0151"
    },
    "吉田町方面": {
      "3系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0341&directionId=kobe0003",
      "9系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0341&directionId=kobe0150"
    }
  },
  "夢野町3丁目": {
    "長田・板宿方面": {
      "3系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0004",
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0015",
      "40系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0053",
      "65系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0081",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0122",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0126"
    },
    "神戸駅方面": {
      "3系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0003",
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0016",
      "65系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0082",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0123",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0325&directionId=kobe0127"
    }
  },
  "宮川町9丁目": {
    "板宿・JR鷹取駅方面": {
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0015",
      "13系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0017",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0122",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0126"
    },
    "長田・神戸駅方面": {
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0015",
      "13系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0017",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0123",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0412&directionId=kobe0127"
    }
  },
  "中山手3丁目(神戸北野ノスタ)": {
    "三宮・福祉センター方面": {
      "7系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0243&directionId=kobe0010"
    },
    "神戸駅方面": {
      "7系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0243&directionId=kobe0009"
    }
  },
  "鷹取団地前": {
    "板宿・JR鷹取駅前方面": {
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0015",
      "13系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0017",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0122",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0126"
    },
    "神戸駅前方面": {
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0016",
      "13系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0017",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0123",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0440&directionId=kobe0127"
    }
  },
  "育英高校前": {
    "板宿・JR鷹取駅前方面": {
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0015",
      "13系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0017",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0122",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0126"
    },
    "神戸駅前方面": {
      "11系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0016",
      "13系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0017",
      "110系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0123",
      "112系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0441&directionId=kobe0127"
    }
  },
  "三宮駅前": {
    "神戸駅前方面": {
      "7系統": "https://location.its-mo.com/usersite/kobe/US0005/search/jp?busStopCode=0224&directionId=kobe0009"
    }
  }
};

const directionSelect = document.getElementById("direction");
const lineSelect = document.getElementById("line");
const showBtn = document.getElementById("showBtn");
const frame = document.getElementById("resultFrame");
const selectedStopDisplay = document.getElementById("selectedStopName");
const pins = document.querySelectorAll(".map-pin");

let currentBusStop = ""; // 現在選択されているバス停名

// 初期化（ローカルストレージ確認）
window.addEventListener("load", () => {
  const saved = JSON.parse(localStorage.getItem("busSelection"));
  if (saved && data[saved.busStop]) {
    // 保存データがあれば復元
    selectBusStop(saved.busStop);
    
    // 方面を復元
    directionSelect.value = saved.direction;
    updateLines();
    
    // 系統を復元
    lineSelect.value = saved.line;

    if (saved.url) {
      frame.src = saved.url;
    }
  }
});

// ピンをクリックした時の処理
pins.forEach(pin => {
  pin.addEventListener("click", (e) => {
    const stopName = e.target.getAttribute("data-stop");
    selectBusStop(stopName);
  });
});

function selectBusStop(stopName) {
  if (!data[stopName]) return;

  currentBusStop = stopName;

  // UI更新：選択されたバス停名を表示
  selectedStopDisplay.textContent = `選択中: ${currentBusStop}`;
  selectedStopDisplay.style.color = "#2e5c2e";

  // UI更新：ピンの色を変える
  pins.forEach(p => p.classList.remove("active"));
  const targetPin = document.querySelector(`.map-pin[data-stop="${stopName}"]`);
  if (targetPin) targetPin.classList.add("active");

  // 方面セレクトボックスを更新
  updateDirections();
}

function updateDirections() {
  directionSelect.innerHTML = '<option value="">方面</option>';
  lineSelect.innerHTML = '<option value="">系統</option>';
  
  if (currentBusStop && data[currentBusStop]) {
    directionSelect.disabled = false;
    lineSelect.disabled = true;

    Object.keys(data[currentBusStop]).forEach(dir => {
      const opt = document.createElement("option");
      opt.value = dir;
      opt.textContent = dir;
      directionSelect.appendChild(opt);
    });
  } else {
    directionSelect.disabled = true;
    lineSelect.disabled = true;
  }
}

function updateLines() {
  lineSelect.innerHTML = '<option value="">系統</option>';
  const direction = directionSelect.value;
  
  if (currentBusStop && direction && data[currentBusStop][direction]) {
    lineSelect.disabled = false;
    Object.keys(data[currentBusStop][direction]).forEach(line => {
      const opt = document.createElement("option");
      opt.value = line;
      opt.textContent = line;
      lineSelect.appendChild(opt);
    });
  } else {
    lineSelect.disabled = true;
  }
}

directionSelect.addEventListener("change", updateLines);

showBtn.addEventListener("click", () => {
  const direction = directionSelect.value;
  const line = lineSelect.value;
  
  if (currentBusStop && direction && line) {
    const url = data[currentBusStop][direction][line];
    frame.src = url;
    
    // ローカルストレージに保存
    localStorage.setItem("busSelection", JSON.stringify({ 
      busStop: currentBusStop, 
      direction, 
      line, 
      url 
    }));
  } else {
    alert("地図からバス停を選び、方面と系統を選択してください。");
  }
});
</script>

</body>
</html>
