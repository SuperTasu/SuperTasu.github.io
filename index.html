<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Link First</title>
  <link rel="icon" href="./icon.png" type="image/png">
  <link rel="apple-touch-icon" href="./icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
  <!-- 外部CSSの読み込み -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="fixed-top-wrapper">
    <div class="clock-area">
        <div class="clock-main-row">
            <div class="left-section">
                <img src="./icon.png" alt="Link First Logo" class="site-logo">
                <div class="datetime-row">
                    <div id="date"></div>
                    <div id="clock"></div>
                    <div id="countdown"></div>
                </div>
            </div>
             <div class="header-controls">
                <!-- Login Button -->
                <div id="auth-btn" title="Googleログイン">
                    <i class="fab fa-google"></i>
                    <img id="user-avatar" src="" alt="User" />
                    <span id="user-name"></span>
                </div>
                <!-- Theme Switcher -->
                <div class="theme-switcher">
                    <div class="theme-dot light" onclick="setTheme('light')" title="Light Mode"></div>
                    <div class="theme-dot dark" onclick="setTheme('dark')" title="Dark Mode"></div>
                </div>
                <!-- Background Changer Button -->
                <div class="control-icon" onclick="openBgModal()" title="背景変更"><i class="fas fa-image"></i></div>
                <!-- Network & Refresh -->
                <div id="network-status" class="online" title="オンライン"><i class="fas fa-wifi"></i> <span>ON</span></div>
                <div class="control-icon" id="refresh-button" onclick="location.reload()"><i class="fas fa-sync-alt"></i></div>
                <!-- SpeedTest PC -->
                <div class="header-speed-test" id="header-speed-test-container">
                    <iframe id="speed-test-iframe" src="https://fast.com/ja/" title="速度テスト" loading="lazy" scrolling="no"></iframe>
                    <div class="control-icon" id="speed-test-refresh-button" onclick="reloadSpeedTest()"><i class="fas fa-redo"></i></div>
                </div>
            </div>
        </div>
    </div>
    <!-- 検索バー -->
    <div class="search-wrapper">
        <div class="search-container"> 
            <i class="fas fa-search"></i> 
            <input type="text" id="globalSearchInput" placeholder="検索..." autocomplete="off"> 
            <i class="fas fa-times hidden" id="clearSearchBtn"></i>
        </div>
        <div id="searchResults" class="search-results-dropdown hidden"></div>
    </div>
  </div>

  <div class="page-container">
      <!-- FYコンテナ: 初期表示にするため display: block を指定 -->
      <div id="fy-container" style="display: block;">
          <div id="fy-clock-display">
              <div class="fy-clock-group">
                  <div id="fy-date-text" class="fy-date-text"></div>
                  <div id="fy-time-text" class="fy-time-text"></div>
              </div>
              <div id="fy-speed-test-placeholder"></div>
          </div>
          <div class="fy-header-row" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
              <h3 class="section-title" style="border:none; margin:0;"><i class="fas fa-star fy-icon"></i> お気に入り (Favorites)</h3>
              <button id="fy-edit-btn" class="edit-btn" onclick="toggleEditMode()" style="padding:5px 15px; border-radius:15px; cursor:pointer; background:var(--input-bg); border:1px solid #ccc;">並び替え</button>
          </div>
          <div id="fy-content-area"></div>
      </div>

    <!-- メイングアプリ一覧: 初期は非表示にするため display: none を指定 -->
    <div class="main-grid" id="main-grid" style="display: none;">
        <div id="all-apps-container">
            <h3 class="section-title">すべてのアプリ</h3>
            <div class="grid-container" id="gridContainer"></div>
        </div>
    </div>

    <!-- Bustarain (交通) コンテナ -->
    <div id="bustarain-container">
        
        <!-- モバイル版 (幅1000px未満) : グリッド表示・新規タブ -->
        <div id="traffic-mobile-view">
            <div class="sub-tab-menu">
                <button class="sub-tab-btn active" onclick="switchMobileSubTab('mobile-train')"><i class="fas fa-train"></i> Train</button>
                <button class="sub-tab-btn" onclick="switchMobileSubTab('mobile-bus')"><i class="fas fa-bus"></i> BUS</button>
            </div>
            
            <div id="mobile-train" class="traffic-grid sub-tab-content">
                <a href="train/wadmisaki-train.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-subway"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">和田岬</div></div></a>
                <a href="train/itayado-train.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-subway"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">帰）板宿新長田経由海岸線</div></div></a>
                <a href="train/Itayado-sannyou.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-train"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">板宿駅（山陽電車）</div></div></a>
            </div>
            <div id="mobile-bus" class="traffic-grid sub-tab-content hidden">
                <a href="bus/Buslocation.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-map-marked-alt"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">バスロケーション</div></div></a>
                <a href="bus/ikuei4split.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-bus"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">Locate育英高校前</div></div></a>
                <a href="bus/iki-kaeri.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-exchange-alt"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">行き・帰り</div></div></a>
                <a href="bus/imadezaike.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-bus-alt"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">今出在家</div></div></a>
                <a href="bus/yumeno3.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-bus-alt"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">夢野町3丁目</div></div></a>
                <a href="bus/takatoridantimae.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-bus-alt"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">高取団地前</div></div></a>
                <a href="bus/Itayado-bus.html" target="_blank" class="app-card traffic-card"><div class="card-left"><i class="fas fa-bus-alt"></i></div><div class="card-divider"></div><div class="card-right"><div class="card-title">板宿駅</div></div></a>
            </div>
        </div>

        <!-- PC版 (幅1000px以上) : 分割レイアウト (改良版) -->
        <div id="traffic-pc-view">
            <!-- 左側: 表示エリア -->
            <div class="pc-traffic-display">
                <div class="pc-display-header" id="pc-header-title">Select Info</div>
                <div class="pc-placeholder" id="pc-placeholder-msg">リストから選択してください</div>
                <iframe id="pc-main-iframe" src=""></iframe>
            </div>

            <!-- 右側: サイドバー -->
            <div class="pc-traffic-sidebar">
                <div class="pc-sidebar-header">
                    <div class="scroll-arrow" onclick="scrollTrafficList(-50)"><i class="fas fa-chevron-up"></i></div>
                    <div class="pc-traffic-tabs">
                        <button class="pc-tab-btn" id="pc-btn-bus" onclick="switchPcTrafficTab('bus')">BUS</button>
                        <button class="pc-tab-btn active" id="pc-btn-train" onclick="switchPcTrafficTab('train')">Train</button>
                    </div>
                </div>

                <!-- Train List -->
                <div id="pc-list-train" class="pc-traffic-list">
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('train/wadmisaki-train.html', this, '和田岬')">和田岬</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('train/wadmisaki-train.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('train/itayado-train.html', this, '帰）板宿新長田経由海岸線')">帰）板宿新長田経由海岸線</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('train/itayado-train.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('train/Itayado-sannyou.html', this, '板宿駅（山陽電車）')">板宿駅（山陽電車）</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('train/Itayado-sannyou.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                </div>

                <!-- Bus List -->
                <div id="pc-list-bus" class="pc-traffic-list hidden">
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/Buslocation.html', this, 'バスロケーション')">バスロケーション</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/Buslocation.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/ikuei4split.html', this, 'Locate育英高校前')">Locate育英高校前</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/ikuei4split.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/iki-kaeri.html', this, '行き・帰り')">行き・帰り</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/iki-kaeri.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/imadezaike.html', this, '今出在家')">今出在家</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/imadezaike.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/yumeno3.html', this, '夢野町3丁目')">夢野町3丁目</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/yumeno3.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/takatoridantimae.html', this, '高取団地前')">高取団地前</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/takatoridantimae.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                    <div class="pc-traffic-item">
                        <span class="pc-item-label" onclick="loadPcTraffic('bus/Itayado-bus.html', this, '板宿駅')">板宿駅</span>
                        <button class="pc-new-tab-btn" onclick="openNewTab('bus/Itayado-bus.html', event)" title="新しいタブで開く"><i class="fas fa-external-link-alt"></i></button>
                    </div>
                </div>

                <div class="pc-sidebar-footer">
                    <div class="scroll-arrow" onclick="scrollTrafficList(50)"><i class="fas fa-chevron-down"></i></div>
                </div>
            </div>
        </div>
    </div>

    <!-- メモ帳 コンテナ -->
    <div id="memo-container">
        <h3 class="section-title"><i class="fas fa-sticky-note"></i> メモ帳 (Auto Save)</h3>
        <textarea id="memo-pad" placeholder="ここにメモを入力..."></textarea>
        <div id="memo-status"></div>
    </div>
  </div>

  <nav class="bottom-nav">
      <!-- FYタブに active クラスを移動 -->
      <div class="tab-item active" id="tab-fy" onclick="activateTab('fy')"> <i class="fas fa-star fy-icon"></i> <span>FY☆</span> </div>
      <div class="tab-item" id="tab-all-apps" onclick="activateTab('all-apps')"> <i class="fas fa-th-large"></i> <span>Apps</span> </div>
      <div class="tab-item" id="tab-bustarain" onclick="activateTab('bustarain')"> <i class="fas fa-bus"></i> <span>Traffic</span> </div>
      <div class="tab-item" id="tab-memo" onclick="activateTab('memo')"> <i class="fas fa-pen-alt"></i> <span>Memo</span> </div>
  </nav>

  <!-- 背景選択モーダル -->
  <div id="bg-select-overlay" class="modal-overlay hidden">
      <div class="modal-box">
          <div class="modal-title">背景を設定</div>
          <div class="modal-desc" style="margin-bottom:20px;">端末内の画像を選択してください</div>
          <input type="file" id="bg-file-input" accept="image/*" style="display:block; margin:0 auto 20px auto;">
          <div class="modal-buttons">
              <button class="modal-btn btn-cancel" onclick="closeBgModal()">キャンセル</button>
              <button class="modal-btn" style="background:#f44336; color:#fff;" onclick="resetBackground()">リセット</button>
          </div>
      </div>
  </div>
  
  <script type="module" src="script.js"></script>
  
  <script>
      // タブ切り替えロジック
      window.activateTab = function(tabName) {
          // コンテナの表示切替
          const containers = ['fy-container', 'main-grid', 'bustarain-container', 'memo-container'];
          containers.forEach(id => {
              const el = document.getElementById(id);
              if (el) el.style.display = 'none';
          });

          // タブのアクティブ状態切替
          const tabs = ['tab-fy', 'tab-all-apps', 'tab-bustarain', 'tab-memo'];
          tabs.forEach(id => {
              const el = document.getElementById(id);
              if (el) el.classList.remove('active');
          });

          // 選択されたタブの表示
          if (tabName === 'fy') {
              document.getElementById('fy-container').style.display = 'block';
              document.getElementById('tab-fy').classList.add('active');
          } else if (tabName === 'all-apps') {
              document.getElementById('main-grid').style.display = 'block';
              document.getElementById('tab-all-apps').classList.add('active');
          } else if (tabName === 'bustarain') {
              document.getElementById('bustarain-container').style.display = 'block';
              document.getElementById('tab-bustarain').classList.add('active');
          } else if (tabName === 'memo') {
              document.getElementById('memo-container').style.display = 'block';
              document.getElementById('tab-memo').classList.add('active');
          }

          // ★ タブ切り替え時に確実に一番上にスクロールする
          setTimeout(() => {
              window.scrollTo(0, 0);
              document.documentElement.scrollTop = 0;
              document.body.scrollTop = 0;
          }, 10);
      };

      // モバイル版のサブタブ切り替え
      window.switchMobileSubTab = function(contentId) {
          document.getElementById('mobile-train').classList.add('hidden');
          document.getElementById('mobile-bus').classList.add('hidden');
          
          document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
          
          document.getElementById(contentId).classList.remove('hidden');
          
          if(contentId === 'mobile-train') {
              document.querySelector('.sub-tab-btn:nth-child(1)').classList.add('active');
          } else {
              document.querySelector('.sub-tab-btn:nth-child(2)').classList.add('active');
          }
      };

      // PC版 Traffic ロジック
      window.switchPcTrafficTab = function(type) {
          const trainList = document.getElementById('pc-list-train');
          const busList = document.getElementById('pc-list-bus');
          const btnTrain = document.getElementById('pc-btn-train');
          const btnBus = document.getElementById('pc-btn-bus');

          if (type === 'train') {
              trainList.classList.remove('hidden');
              busList.classList.add('hidden');
              btnTrain.classList.add('active');
              btnBus.classList.remove('active');
          } else {
              trainList.classList.add('hidden');
              busList.classList.remove('hidden');
              btnTrain.classList.remove('active');
              btnBus.classList.add('active');
          }
      };

      // PC版: iframeで読み込む
      window.loadPcTraffic = function(url, labelElement, title) {
          const iframe = document.getElementById('pc-main-iframe');
          const placeholder = document.getElementById('pc-placeholder-msg');
          const headerTitle = document.getElementById('pc-header-title');
          
          placeholder.style.display = 'none';
          iframe.src = url;
          if(title) headerTitle.textContent = title;

          // アクティブ状態の装飾 (親要素に適用)
          document.querySelectorAll('.pc-traffic-item').forEach(el => el.classList.remove('active'));
          // ラベルの親要素(pc-traffic-item)を取得してactiveにする
          if(labelElement && labelElement.parentElement) {
              labelElement.parentElement.classList.add('active');
          }
      };

      // PC版: 新しいタブで開く
      window.openNewTab = function(url, event) {
          event.stopPropagation(); // 親要素のclickイベント(iframe読み込み)を阻止
          window.open(url, '_blank');
      }

      window.scrollTrafficList = function(amount) {
          const activeList = document.querySelector('.pc-traffic-list:not(.hidden)');
          if(activeList) {
              activeList.scrollBy({ top: amount, behavior: 'smooth' });
          }
      };

      // メモ帳の自動保存ロジック
      document.addEventListener('DOMContentLoaded', () => {
          const memoPad = document.getElementById('memo-pad');
          const memoStatus = document.getElementById('memo-status');

          if (memoPad) {
              const savedMemo = localStorage.getItem('userMemo');
              if (savedMemo) {
                  memoPad.value = savedMemo;
              }

              let timeoutId;
              memoPad.addEventListener('input', () => {
                  memoStatus.textContent = '保存中...';
                  clearTimeout(timeoutId);
                  timeoutId = setTimeout(() => {
                      localStorage.setItem('userMemo', memoPad.value);
                      memoStatus.textContent = '保存しました';
                      setTimeout(() => { memoStatus.textContent = ''; }, 2000);
                  }, 1000); 
              });
          }
      });
  </script>
</body>
</html>
