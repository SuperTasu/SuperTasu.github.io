<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Link First</title>
  <link rel="icon" href="./icon.png" type="image/png">
  <link rel="apple-touch-icon" href="./icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <!-- FontAwesome & Google Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />
  
  <style>
    /* --- CSS変数 --- */
    :root {
      --bg-color: #ffffff;
      --text-color-primary: #333333;
      --text-color-secondary: #666;
      --card-bg: #fff;
      --card-border-color: #333; /* 画像に合わせて黒っぽい枠線 */
      --card-radius: 20px;
      
      --tab-active-bg: #667eea;
      --tab-active-text: #ffffff;
      
      --nav-bg: rgba(255, 255, 255, 0.98);
      --input-bg: #e9ecef;
    }
    body.dark-theme {
      --bg-color: #2c2c2c;
      --text-color-primary: #f5f5f5;
      --text-color-secondary: #aaa;
      --card-bg: #3a3a3a;
      --card-border-color: #888;
      
      --nav-bg: rgba(50, 50, 50, 0.98);
      --input-bg: #444;
    }

    body {
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color-primary);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: background-color 0.3s, color 0.3s;
      padding: 0;
      box-sizing: border-box;
      min-height: 100vh;
      padding-bottom: 80px; /* 下部ナビ用余白 */
      padding-top: 100px; /* 上部ヘッダー用余白 */
      overflow-x: hidden; /* 横スクロール防止 */
    }

    /* ★★★ 固定ヘッダー ★★★ */
    .fixed-top-wrapper {
      position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
      background-color: #000; color: #fff;
      padding: 5px 0 10px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .clock-area { 
        padding: 0 15px; display: flex; align-items: center; height: 30px; 
    }
    .clock-main-row { display: flex; width: 100%; align-items: center; gap: 10px; }
    .site-logo { height: 26px; width: auto; border-radius: 4px; }
    .datetime-row { display: flex; gap: 10px; font-size: 14px; font-weight: bold; }
    #countdown { color: #88aaff; }
    
    .header-controls { display: flex; gap: 10px; margin-left: 15px; }
    .theme-dot { width: 10px; height: 10px; border-radius: 50%; cursor: pointer; border: 1px solid #888; } 
    .theme-dot.light { background: #fff; }
    .theme-dot.dark { background: #444; }
    .control-icon { cursor: pointer; color: #aaa; }
    .control-icon:hover { color: #fff; }

    /* 速度テスト */
    .header-speed-test { position: absolute; right: 10px; top: 5px; z-index: 1100; display: flex; gap: 5px;}
    .header-speed-test iframe { width: 120px; height: 50px; border: none; border-radius: 8px; background: #fff; pointer-events: auto; }
    #speed-test-refresh-button { color: #aaa; cursor: pointer; background: rgba(0,0,0,0.5); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }

    /* ★★★ 検索バー（常に表示） ★★★ */
    .search-wrapper { 
        position: fixed; top: 45px; left: 0; width: 100%; z-index: 1000;
        display: flex; justify-content: center; padding: 0 10px; box-sizing: border-box;
    }
    .search-container { 
        width: 90%; max-width: 600px; height: 36px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px; display: flex; align-items: center; padding: 0 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    #globalSearchInput { border: none; background: transparent; outline: none; width: 100%; font-size: 15px; color: #333; }
    #clearSearchBtn { cursor: pointer; color: #777; margin-left: 5px; }
    .search-results-dropdown {
        position: absolute; top: 40px; left: 50%; transform: translateX(-50%);
        width: 90%; max-width: 600px; background: var(--card-bg);
        border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        max-height: 60vh; overflow-y: auto; padding: 5px; z-index: 5500;
    }
    .search-results-dropdown.hidden { display: none; }
    .search-result-item { padding: 10px; border-bottom: 1px solid var(--card-border-color); display: flex; align-items: center; text-decoration: none; color: var(--text-color-primary); }
    .search-result-item:hover { background: rgba(0,0,0,0.05); }

    /* ★★★ メインコンテンツエリア ★★★ */
    .page-container {
        width: 100%; max-width: 1200px; margin: 0 auto;
        padding-left: 10px; padding-right: 10px;
        overflow: hidden; /* スワイプ用にはみ出しを隠す */
    }

    /* --- スワイプコンテナ (FY & Apps) --- */
    .swipe-container {
        display: flex;
        width: 200%; /* 2画面分 */
        transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        will-change: transform;
    }
    .swipe-slide {
        width: 50%;
        padding: 0 10px;
        box-sizing: border-box;
    }

    /* --- FY専用 時計表示 --- */
    .fy-clock-container {
        text-align: center; margin: 10px 0 20px 0;
        padding: 10px; background: var(--card-bg);
        border-radius: 15px; border: 1px solid var(--card-border-color);
    }
    #fy-clock-time { font-size: 2em; font-weight: bold; font-family: monospace; color: var(--text-color-primary); }
    #fy-clock-date { font-size: 1em; color: var(--text-color-secondary); }

    /* --- 新しいカードデザイン (Grid Layout) --- */
    .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* PCでは複数列 */
        gap: 15px;
        padding-bottom: 20px;
    }
    
    .app-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border-color);
        border-radius: 25px; /* 丸みを強く */
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        transition: transform 0.2s;
    }
    .app-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

    /* 左側：アイコンエリア */
    .card-icon-area {
        width: 70px; height: 70px;
        flex-shrink: 0;
        background: #f0f0f0; /* 背景がないアイコン用 */
        border-radius: 18px;
        overflow: hidden;
        cursor: pointer;
        border: 1px solid rgba(0,0,0,0.1);
    }
    .card-icon-area img { width: 100%; height: 100%; object-fit: contain; }

    /* 右側：情報＆ボタンエリア */
    .card-info-area {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 70px; /* アイコンの高さに合わせる */
        padding-right: 5px;
    }

    /* アプリ名 (下線付き) */
    .card-app-name {
        font-weight: bold;
        font-size: 16px;
        color: var(--text-color-primary);
        border-bottom: 1px solid var(--text-color-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-bottom: 2px;
        margin-bottom: auto; /* ボタンを下に押しやる */
    }

    /* ボタン群 (3つの四角) */
    .card-buttons-row {
        display: flex;
        gap: 10px;
        justify-content: flex-start;
    }
    .card-btn {
        width: 32px; height: 32px;
        border: 1px solid var(--text-color-primary);
        border-radius: 6px;
        background: transparent;
        color: var(--text-color-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s, color 0.2s;
    }
    .card-btn:hover { background: var(--text-color-primary); color: var(--bg-color); }
    
    /* お気に入りアクティブ */
    .card-btn.fav-active { background: #ffc107; border-color: #ffc107; color: #fff; }
    .card-btn.fav-active:hover { background: #ffca2c; }

    /* --- Bustarain / Option (初期非表示) --- */
    .content-view { display: none; padding-top: 10px; animation: fadeIn 0.3s; }
    .content-view.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Bustarainのアコーディオンなど */
    .sub-tab-menu { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; }
    .sub-tab-btn { background: var(--input-bg); border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; color: var(--text-color-secondary); }
    .sub-tab-btn.active { background: #667eea; color: #fff; }
    .accordion-item { border: 1px solid var(--card-border-color); border-radius: 12px; margin-bottom: 10px; background: var(--card-bg); overflow: hidden; }
    .accordion-header { padding: 15px; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; }
    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s; }
    .accordion-content iframe { width: 100%; height: 500px; border: none; }
    .accordion-item.active .accordion-content { max-height: 1000px; }

    /* --- 下部固定ナビゲーション --- */
    .bottom-nav {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background-color: var(--nav-bg);
        border-top: 1px solid rgba(0,0,0,0.1);
        display: flex; justify-content: space-around;
        padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
        z-index: 2000;
        backdrop-filter: blur(10px);
    }
    .tab-item {
        flex: 1; text-align: center; color: var(--text-color-secondary);
        font-size: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px;
    }
    .tab-item i { font-size: 20px; }
    .tab-item.active { color: #667eea; }

    /* ユーティリティ */
    .hidden { display: none !important; }

  </style>
</head>
<body>

  <!-- ヘッダー -->
  <div class="fixed-top-wrapper">
    <div class="clock-area">
        <div class="clock-main-row">
            <img src="./icon.png" alt="Logo" class="site-logo">
            <div class="datetime-row">
                <div id="header-date"></div>
                <div id="header-clock"></div>
            </div>
            <div class="header-controls">
                <div class="theme-dot light" onclick="setTheme('light')"></div>
                <div class="theme-dot dark" onclick="setTheme('dark')"></div>
                <i class="fas fa-sync-alt control-icon" onclick="location.reload()"></i>
            </div>
            
            <div class="header-speed-test">
                <iframe src="https://fast.com/ja/" scrolling="no"></iframe>
                <div id="speed-test-refresh-button" onclick="document.querySelector('.header-speed-test iframe').src += ''"><i class="fas fa-redo"></i></div>
            </div>
        </div>
    </div>
    
    <!-- 検索ボックス（常駐） -->
    <div class="search-wrapper">
        <div class="search-container">
            <i class="fas fa-search" style="color:#666; margin-right:8px;"></i>
            <input type="text" id="globalSearchInput" placeholder="検索..." autocomplete="off">
            <i class="fas fa-times hidden" id="clearSearchBtn"></i>
        </div>
        <div id="searchResults" class="search-results-dropdown hidden"></div>
    </div>
  </div>

  <div class="page-container">
      
      <!-- ★ Swipable View (FY & Apps) ★ -->
      <div id="swipe-view-wrapper" class="content-view active">
          <div class="swipe-container" id="swipeContainer">
              
              <!-- 左: FY (Favorites) Slide -->
              <div class="swipe-slide" id="fy-slide">
                  <!-- FY専用デジタル時計 -->
                  <div class="fy-clock-container">
                      <div id="fy-clock-date">----/--/--</div>
                      <div id="fy-clock-time">--:--:--</div>
                  </div>
                  
                  <h3 style="margin-left:5px;">FY☆ Favorites</h3>
                  <div id="fy-list-area" class="cards-grid">
                      <!-- JSで生成されるお気に入りカード -->
                      <div style="text-align:center; width:100%; color:#888;">No Favorites</div>
                  </div>
              </div>

              <!-- 右: Apps Slide -->
              <div class="swipe-slide" id="apps-slide">
                  <h3 style="margin-left:5px;">All Apps</h3>
                  <div id="apps-list-area" class="cards-grid">
                      <!-- JSで生成されるアプリカード -->
                  </div>
              </div>
          </div>
      </div>

      <!-- ★ Traffic (Bustarain) View ★ -->
      <div id="bustarain-view" class="content-view">
          <div class="sub-tab-menu">
              <button class="sub-tab-btn active" onclick="switchTrafficTab('train')"><i class="fas fa-train"></i> Train</button>
              <button class="sub-tab-btn" onclick="switchTrafficTab('bus')"><i class="fas fa-bus"></i> Bus</button>
          </div>
          
          <div id="traffic-train-content">
              <!-- 例: トレインコンテンツ -->
              <div class="accordion-item">
                  <div class="accordion-header" onclick="toggleAccordion(this)">
                      <span>和田岬</span><i class="fas fa-chevron-down"></i>
                  </div>
                  <div class="accordion-content">
                      <iframe data-src="train/wadmisaki-train.html"></iframe>
                  </div>
              </div>
              <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>板宿駅（山陽電車）</span><i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe data-src="train/Itayado-sannyou.html"></iframe>
                </div>
            </div>
          </div>

          <div id="traffic-bus-content" class="hidden">
              <div class="accordion-item">
                  <div class="accordion-header" onclick="toggleAccordion(this)">
                      <span>バスロケーション</span><i class="fas fa-chevron-down"></i>
                  </div>
                  <div class="accordion-content">
                      <iframe data-src="bus/Buslocation.html"></iframe>
                  </div>
              </div>
              <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>高取団地前</span><i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe data-src="bus/takatoridantimae.html"></iframe>
                </div>
            </div>
          </div>
      </div>

      <!-- ★ Option View ★ -->
      <div id="option-view" class="content-view">
          <h3>Option</h3>
          <div class="app-card" style="display:block; padding:20px;">
              <p>設定項目などがここに入ります。</p>
              <button onclick="localStorage.clear(); location.reload();" style="padding:10px; background:#ff4444; color:white; border:none; border-radius:8px;">データ初期化</button>
          </div>
      </div>

  </div>

  <!-- 下部ナビゲーション -->
  <nav class="bottom-nav">
      <div class="tab-item" id="nav-fy" onclick="activateTab('fy')">
          <i class="fas fa-star" style="color: #ffc107;"></i>
          <span>FY☆</span>
      </div>
      <div class="tab-item active" id="nav-apps" onclick="activateTab('apps')">
          <i class="fas fa-th-large"></i>
          <span>Apps</span>
      </div>
      <div class="tab-item" id="nav-traffic" onclick="activateTab('traffic')">
          <i class="fas fa-bus"></i>
          <span>Traffic</span>
      </div>
      <div class="tab-item" id="nav-option" onclick="activateTab('option')">
          <i class="fas fa-cog"></i>
          <span>Option</span>
      </div>
  </nav>

  <script>
    // --- データ定義 (デモ用: 本来は外部JS等から取得) ---
    // 画像はプレースホルダーを使用しています
    const sampleAppsData = [
        { id: 'app1', name: 'Google', url: 'https://www.google.com', icon: 'https://www.google.com/favicon.ico' },
        { id: 'app2', name: 'YouTube', url: 'https://www.youtube.com', icon: 'https://www.youtube.com/favicon.ico' },
        { id: 'app3', name: 'Yahoo! JAPAN', url: 'https://www.yahoo.co.jp', icon: 'https://s.yimg.jp/c/icon/s/32/yahoo.ico' },
        { id: 'app4', name: 'GitHub', url: 'https://github.com', icon: 'https://github.com/fluidicon.png' },
        { id: 'app5', name: 'Weather', url: 'https://weather.yahoo.co.jp/weather/', icon: './icon.png' },
        { id: 'app6', name: 'Map', url: 'https://maps.google.com', icon: 'https://www.google.com/images/branding/product/ico/maps15/v1/32dp.png' },
        { id: 'app7', name: 'Translate', url: 'https://translate.google.com', icon: 'https://www.gstatic.com/images/branding/product/1x/translate_24dp.png' },
        { id: 'app8', name: 'Amazon', url: 'https://www.amazon.co.jp', icon: 'https://www.amazon.co.jp/favicon.ico' },
    ];

    let favorites = JSON.parse(localStorage.getItem('myFavorites')) || [];

    // --- 初期化 ---
    document.addEventListener('DOMContentLoaded', () => {
        updateClock();
        setInterval(updateClock, 1000);
        renderApps();
        renderFavorites();
        
        // 初期タブ (Apps)
        activateTab('apps');
        
        // テーマ復元
        if(localStorage.getItem('theme') === 'dark') setTheme('dark');

        // スワイプイベント設定
        setupSwipe();
    });

    // --- 時計更新 ---
    function updateClock() {
        const now = new Date();
        
        // ヘッダー用 (短い形式)
        const dateStr = `${now.getMonth()+1}/${now.getDate()}(${['日','月','火','水','木','金','土'][now.getDay()]})`;
        const timeStr = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('header-date').innerText = dateStr;
        document.getElementById('header-clock').innerText = timeStr;

        // FYタブ用 (秒まで表示)
        const fyDateStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')}`;
        const fyTimeStr = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        document.getElementById('fy-clock-date').innerText = fyDateStr;
        document.getElementById('fy-clock-time').innerText = fyTimeStr;
    }

    // --- カード生成ロジック ---
    function createCardHTML(app) {
        const isFav = favorites.includes(app.id);
        const favClass = isFav ? 'fav-active' : '';
        
        // アイコンがない場合はデフォルト
        const iconSrc = app.icon || './icon.png';

        return `
        <div class="app-card" data-id="${app.id}">
            <div class="card-icon-area" onclick="window.location.href='${app.url}'" title="開く">
                <img src="${iconSrc}" alt="${app.name}" onerror="this.src='./icon.png'">
            </div>
            <div class="card-info-area">
                <div class="card-app-name" title="${app.name}">${app.name}</div>
                <div class="card-buttons-row">
                    <button class="card-btn" onclick="window.location.href='${app.url}'" title="このページで開く">
                        <i class="fas fa-sign-in-alt"></i> <!-- 入室アイコン風 -->
                    </button>
                    <button class="card-btn" onclick="window.open('${app.url}', '_blank')" title="新しいタブで開く">
                        <i class="fas fa-external-link-alt"></i>
                    </button>
                    <button class="card-btn ${favClass}" onclick="toggleFavorite('${app.id}', this)" title="お気に入り">
                        <i class="fas fa-star"></i>
                    </button>
                </div>
            </div>
        </div>
        `;
    }

    function renderApps() {
        const container = document.getElementById('apps-list-area');
        container.innerHTML = sampleAppsData.map(app => createCardHTML(app)).join('');
    }

    function renderFavorites() {
        const container = document.getElementById('fy-list-area');
        if (favorites.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#888; padding:20px;">お気に入りがありません<br>Appsタブから★を押して追加してください</div>';
            return;
        }
        const favApps = sampleAppsData.filter(app => favorites.includes(app.id));
        container.innerHTML = favApps.map(app => createCardHTML(app)).join('');
    }

    function toggleFavorite(appId, btnElement) {
        if (favorites.includes(appId)) {
            favorites = favorites.filter(id => id !== appId);
            btnElement.classList.remove('fav-active');
        } else {
            favorites.push(appId);
            btnElement.classList.add('fav-active');
        }
        localStorage.setItem('myFavorites', JSON.stringify(favorites));
        renderFavorites(); // FYリストを再描画
        // Appsリスト側の★も同期
        renderApps();
    }

    // --- タブ切り替え & スワイプ制御 ---
    let currentTab = 'apps';

    function activateTab(tabName) {
        currentTab = tabName;
        
        // 下部ナビの見た目更新
        document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
        if(tabName === 'fy') document.getElementById('nav-fy').classList.add('active');
        if(tabName === 'apps') document.getElementById('nav-apps').classList.add('active');
        if(tabName === 'traffic') document.getElementById('nav-traffic').classList.add('active');
        if(tabName === 'option') document.getElementById('nav-option').classList.add('active');

        // ビューの切り替え
        const swipeWrapper = document.getElementById('swipe-view-wrapper');
        const bustarainView = document.getElementById('bustarain-view');
        const optionView = document.getElementById('option-view');

        // 全て非表示にしてから...
        swipeWrapper.classList.remove('active');
        bustarainView.classList.remove('active');
        optionView.classList.remove('active');

        if (tabName === 'fy' || tabName === 'apps') {
            swipeWrapper.classList.add('active');
            const swipeContainer = document.getElementById('swipeContainer');
            // FYなら 0%, Appsなら -50% (スライド幅は親の50%なので)
            // swipeContainer width = 200%. Left half is FY, Right half is Apps.
            // translate(0) -> Shows Left (FY). translate(-50%) -> Shows Right (Apps).
            if (tabName === 'fy') {
                swipeContainer.style.transform = 'translateX(0%)';
            } else {
                swipeContainer.style.transform = 'translateX(-50%)';
            }
        } else if (tabName === 'traffic') {
            bustarainView.classList.add('active');
        } else if (tabName === 'option') {
            optionView.classList.add('active');
        }
    }

    // --- スワイプジェスチャー ---
    function setupSwipe() {
        const container = document.getElementById('swipeContainer');
        let startX = 0;
        let isSwiping = false;

        container.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isSwiping = true;
        }, {passive: true});

        container.addEventListener('touchend', (e) => {
            if (!isSwiping) return;
            const endX = e.changedTouches[0].clientX;
            const diff = startX - endX;

            // しきい値を超えたら切り替え (50px)
            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    // 左へスワイプ (FY -> Apps)
                    if (currentTab === 'fy') activateTab('apps');
                } else {
                    // 右へスワイプ (Apps -> FY)
                    if (currentTab === 'apps') activateTab('fy');
                }
            }
            isSwiping = false;
        }, {passive: true});
    }

    // --- Trafficタブ内のサブタブ ---
    function switchTrafficTab(type) {
        document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active'); // クリックしたボタン

        const trContent = document.getElementById('traffic-train-content');
        const bsContent = document.getElementById('traffic-bus-content');
        
        if (type === 'train') {
            trContent.classList.remove('hidden');
            bsContent.classList.add('hidden');
        } else {
            trContent.classList.add('hidden');
            bsContent.classList.remove('hidden');
        }
    }

    // --- アコーディオン制御 ---
    function toggleAccordion(header) {
        const item = header.parentElement;
        item.classList.toggle('active');
        
        // 開いたときにiframeのsrcをセット（遅延読み込み）
        const content = item.querySelector('.accordion-content');
        const iframe = content.querySelector('iframe');
        if (item.classList.contains('active') && iframe && !iframe.src && iframe.dataset.src) {
            iframe.src = iframe.dataset.src;
        }
    }

    // --- 検索機能 ---
    const searchInput = document.getElementById('globalSearchInput');
    const searchResults = document.getElementById('searchResults');
    const clearBtn = document.getElementById('clearSearchBtn');

    searchInput.addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        if (!val) {
            searchResults.classList.add('hidden');
            clearBtn.classList.add('hidden');
            return;
        }
        clearBtn.classList.remove('hidden');
        searchResults.classList.remove('hidden');
        
        const hits = sampleAppsData.filter(app => app.name.toLowerCase().includes(val));
        
        if (hits.length === 0) {
            searchResults.innerHTML = '<div style="padding:10px; color:#666;">見つかりません</div>';
        } else {
            searchResults.innerHTML = hits.map(app => `
                <a href="${app.url}" class="search-result-item">
                    <img src="${app.icon || './icon.png'}" style="width:24px; height:24px; margin-right:10px; border-radius:4px;">
                    <span>${app.name}</span>
                </a>
            `).join('');
        }
    });

    clearBtn.addEventListener('click', () => {
        searchInput.value = '';
        searchResults.classList.add('hidden');
        clearBtn.classList.add('hidden');
    });

    // --- テーマ切り替え ---
    function setTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
        }
        localStorage.setItem('theme', theme);
    }
  </script>
</body>
</html>
