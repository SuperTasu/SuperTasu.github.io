<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Link First</title>
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png" sizes="180x180">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- フォント・アイコン読み込み -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />
   
  <style>
    /* --- CSS変数定義 --- */
    :root {
      --bg-color: #ffffff;
      --text-color-primary: #333;
      --text-color-secondary: #666;
      --card-bg: #f8f9fa; /* グラデーション廃止でフラットに */
      --card-border-color: #ddd;
      --card-shadow: 0 2px 5px rgba(0,0,0,0.05);
      --icon-bg: #fff;
      --icon-shadow: 0 2px 4px rgba(0,0,0,0.1);
      --tab-active-text: #ffffff;
      --input-bg: #e9ecef;
      --bus-board-bg: #e8f5e8;
      --bus-card-bg: #fff;
      --save-toggle-color-on: #009900;
    }
    body.dark-theme {
      --bg-color: #222;
      --text-color-primary: #f5f5f5;
      --text-color-secondary: #aaa;
      --card-bg: #333;
      --card-border-color: #444;
      --card-shadow: 0 2px 5px rgba(0,0,0,0.3);
      --icon-bg: #444;
      --icon-shadow: 0 2px 4px rgba(0,0,0,0.4);
      --tab-active-text: #ffffff;
      --input-bg: #444;
      --bus-board-bg: #2a3a2a;
      --bus-card-bg: #3c4c3c;
      --save-toggle-color-on: #76ff03;
    }

    /* --- 基本スタイル --- */
    body { 
      margin: 0; 
      background-color: var(--bg-color); 
      color: var(--text-color-primary); 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      transition: background-color 0.3s, color 0.3s; 
      padding: 0; /* 固定ヘッダーのためbodyパディングはリセット */
      box-sizing: border-box; 
    }

    /* ▼▼▼ 固定ヘッダー分の余白を確保 ▼▼▼ */
    .page-container { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 140px 20px 20px 20px; /* 上部の余白を時計の高さに合わせる */
    }

    /* ▼▼▼ 時計エリアのみ固定 ▼▼▼ */
    .fixed-top-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      background-color: var(--bg-color);
      border-bottom: 1px solid var(--card-border-color);
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      transition: background-color 0.3s;
    }

    /* 時計エリア（四角くデザイン変更） */
    .clock-area { 
        background: var(--card-bg); 
        padding: 10px 20px; 
        /* border-radius削除で四角く */
        border-radius: 0;
        display: flex; 
        flex-direction: column; 
        align-items: stretch;
        max-width: 1200px;
        margin: 0 auto; /* 中央寄せ */
    }
    .clock-main-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
    .clock-content-wrapper { display: flex; flex-direction: column; align-items: flex-start; gap: 5px; flex-grow: 1; }
    .datetime-row { display: flex; align-items: center; justify-content: flex-start; gap: 15px; flex-wrap: wrap; }
    #date, #clock { color: var(--text-color-primary); font-weight: bold; letter-spacing: 1px; }
    #date { font-size: 16px; }
    #clock { font-size: 22px; font-family: 'Courier New', Courier, monospace; }
    #countdown { color: #667eea; font-weight: bold; font-size: 16px; }
    #offline-status { color: red; font-weight: bold; display: none; }

    /* スピードテスト */
    .header-speed-test { display: flex; align-items: center; gap: 8px; }
    .header-speed-test iframe {
        width: 130px; height: 35px;
        border: 1px solid var(--card-border-color);
        border-radius: 0; /* 四角く */
        background: #fff;
    }
    #speed-test-refresh-button { cursor: pointer; color: var(--text-color-secondary); }

    /* テーマ切り替え・更新ボタン */
    .header-controls { display: flex; align-items: center; gap: 10px; }
    .theme-switcher { display: flex; gap: 5px; margin-left: 10px; }
    .theme-dot { width: 14px; height: 14px; cursor: pointer; border: 1px solid var(--text-color-secondary); } /* 丸から四角へ */
    .theme-dot.light { background-color: #f8f9fa; }
    .theme-dot.dark { background-color: #434343; }
    .control-icon { 
        display: flex; align-items: center; justify-content: center; 
        width: 36px; height: 36px; 
        background: rgba(0,0,0,0.05); border-radius: 0; /* 四角く */
        color: var(--text-color-secondary); cursor: pointer; 
        transition: all 0.2s;
    }
    .control-icon:hover { background: #667eea; color: white; }

    /* --- タブ・検索（固定しない） --- */
    .tab-container { 
        background: var(--card-bg); 
        margin-top: 10px; 
        border: 1px solid var(--card-border-color); 
        border-radius: 0; /* 四角く */
    }
    .tab-menu { display: flex; align-items: center; justify-content: center; padding: 10px; flex-wrap: wrap; gap: 5px; }
    
    .search-wrapper { display: flex; justify-content: center; padding: 10px 15px 0 15px; width: 100%; box-sizing: border-box; }
    .search-container { 
        display: flex; align-items: center; padding: 0 15px; 
        background-color: var(--input-bg); 
        border: 1px solid var(--card-border-color); 
        border-radius: 0; /* 四角く */
        width: 100%; max-width: 600px; height: 40px; 
    }
    .search-container i.fa-search { color: var(--text-color-secondary); margin-right: 8px; }
    #appSearchInput { border: none; background: transparent; outline: none; padding: 5px; font-size: 16px; width: 100%; color: var(--text-color-primary); }
    #clearSearchBtn { cursor: pointer; color: #999; }

    .tab-item {
        padding: 10px 20px;
        color: var(--text-color-secondary); 
        font-weight: bold; font-size: 14px; 
        cursor: pointer; 
        border-radius: 0; /* 四角く */
        border: 1px solid transparent;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        transition: all 0.2s;
    }
    .tab-item:hover { background-color: rgba(0,0,0,0.05); color: #333; }
    .tab-item.active { 
        background-color: #667eea; 
        color: #fff; 
        border-color: #667eea;
    }
    .fy-icon { color: #ffc107; }

    /* Apps グリッド */
    .main-grid { margin-top: 20px; }
    .grid-container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: flex-start; padding: 10px; }

    /* アイコンアイテム */
    .icon-item { 
        text-align: center; width: 80px; margin: 5px; 
        position: relative; 
        user-select: none; 
    }
    /* アプリアイコン内の☆（右上） */
    .icon-item .fav-btn {
        position: absolute !important;
        top: -8px !important;    
        right: 0px !important;   
        background: var(--card-bg); 
        border: 1px solid var(--card-border-color);
        border-radius: 0; /* 四角く */
        width: 24px; height: 24px;
        display: flex; align-items: center; justify-content: center;
        z-index: 10; cursor: pointer;
        color: #ccc; 
        font-size: 14px;
        transition: all 0.2s;
    }
    .icon-item .fav-btn.active { color: #ffc107; font-weight: bold; }
    .icon-item .fav-btn:hover { background: #eee; }
    
    .icon-link {
        width: 60px; height: 60px;
        background-color: var(--icon-bg); 
        border-radius: 4px; /* 少しだけ角丸 */
        box-shadow: var(--icon-shadow); 
        display: flex; align-items: center; justify-content: center;
        text-decoration: none; color: var(--text-color-primary);
        margin: 0 auto; 
        position: relative;
        transition: transform 0.2s;
    }
    .icon-link:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .icon-img { width: 32px; height: 32px; object-fit: contain; }
    .label-text { font-size: 11px; margin-top: 5px; color: var(--text-color-primary); word-break: break-word; font-weight: bold; }

    /* Bustarain スタイル */
    #bustarain-container, #option-container, #fy-container { display: none; margin-top: 20px; }
    .sub-tab-menu { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--card-border-color); padding-bottom: 10px; flex-wrap: wrap; justify-content: center; } 
    .sub-tab-btn { 
        background: var(--input-bg); color: var(--text-color-secondary); border: none; 
        padding: 8px 20px; border-radius: 0; /* 四角く */
        font-weight: bold; cursor: pointer; 
    } 
    .sub-tab-btn.active { background: #667eea; color: white; } 

    /* アコーディオン */
    .accordion-item { 
        border: 1px solid var(--card-border-color); 
        margin-bottom: 10px; background: var(--card-bg); 
    } 
    .accordion-header { 
        padding: 15px; font-weight: bold; cursor: pointer; 
        display: flex; justify-content: space-between; align-items: center; 
    }
    /* アコーディオンヘッダー内の☆ボタン */
    .accordion-header .acc-fav-btn {
        margin-right: 15px; margin-left: auto;
        color: #ccc; padding: 5px; cursor: pointer;
        font-size: 18px;
    }
    .accordion-header .acc-fav-btn.active { color: #ffc107; }
    
    .accordion-header .fa-chevron-down { transition: transform 0.3s ease; } 
    .accordion-item.active .accordion-header .fa-chevron-down { transform: rotate(180deg); } 
    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; padding: 0 15px; } 
    .accordion-item.active .accordion-content { max-height: 1200px; padding: 15px 0; } 
    .accordion-iframe { width: 100%; height: 600px; border: none; }

    .hidden { display: none !important; }
    .section-title { font-size: 18px; color: var(--text-color-secondary); margin: 15px 0 10px; border-bottom: 1px solid var(--card-border-color); }
    .option-card { background: var(--card-bg); padding: 15px; margin-bottom: 10px; border: 1px solid var(--card-border-color); }

    /* レスポンシブ */
    @media (max-width: 768px) {
        .page-container { padding-top: 160px; } /* スマホでのヘッダー高さ調整 */
        .clock-area { padding: 10px; }
        .tab-item { flex-grow: 1; justify-content: center; padding: 10px 5px; font-size: 12px; }
    }
  </style>
</head>
<body>

<!-- ▼▼▼ 1. 固定ヘッダーエリア（時計のみ） ▼▼▼ -->
<div class="fixed-top-wrapper">
    <header class="clock-area">
        <div class="clock-main-row">
            <div class="clock-content-wrapper">
                <div class="datetime-row">
                    <div id="date"></div>
                    <div id="clock"></div>
                    <div id="countdown"></div>
                    <div id="offline-status">OFFLINE</div>
                    
                    <div class="header-speed-test">
                        <iframe src="https://fast.com/ja/" title="速度テスト" loading="lazy" scrolling="no"></iframe>
                        <div class="control-icon" id="speed-test-refresh-button" onclick="reloadSpeedTest()" title="速度テスト再実行">
                            <i class="fas fa-redo"></i> 
                        </div>
                    </div>

                    <div class="theme-switcher">
                        <div class="theme-dot light" onclick="setTheme('light')" title="Light Mode"></div>
                        <div class="theme-dot dark" onclick="setTheme('dark')" title="Dark Mode"></div>
                    </div>
                </div>
            </div>
            <div class="header-controls">
                <div class="control-icon" id="refresh-button" title="再読み込み" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i> 
                </div>
            </div>
        </div>
    </header>
</div>

<div class="page-container">
    
    <!-- ▼▼▼ 2. タブメニュー & 検索（スクロール対象） ▼▼▼ -->
    <div class="tab-container">
        <div class="search-wrapper">
            <div class="search-container"> 
                <i class="fas fa-search"></i> 
                <input type="text" id="appSearchInput" placeholder="アプリを検索..."> 
                <i class="fas fa-times hidden" id="clearSearchBtn"></i>
            </div>
        </div>
        
        <div class="tab-menu">
            <!-- FY☆ タブ -->
            <div class="tab-item" id="tab-fy" onclick="activateTab('fy')"> 
                <i class="fas fa-star fy-icon"></i> FY☆ 
            </div>
            <!-- Apps タブ -->
            <div class="tab-item active" id="tab-all-apps" onclick="activateTab('all-apps')"> 
                <i class="fas fa-th-large"></i> Apps 
            </div>
            <!-- Bustarain タブ -->
            <div class="tab-item" id="tab-bustarain" onclick="activateTab('bustarain')"> 
                <i class="fas fa-bus"></i> Bustarain 
            </div>
            <!-- Option タブ -->
            <div class="tab-item" id="tab-option" onclick="activateTab('option')"> 
                <i class="fas fa-cog"></i> Option 
            </div>
        </div>
    </div>

    <!-- ▼▼▼ 3. コンテンツエリア ▼▼▼ -->

    <!-- FY (Favorites) -->
    <div id="fy-container">
        <h3 class="section-title"><i class="fas fa-star fy-icon"></i> お気に入り (Favorites)</h3>
        <div id="fy-content-area" class="grid-container">
            <!-- JSで動的に追加 -->
        </div>
    </div>

    <!-- Apps (Main) -->
    <div class="main-grid" id="main-grid">
      <div class="apps-area">
        <div id="all-apps-container">
            <h3 class="section-title">すべてのアプリ</h3>
            <div class="grid-container" id="gridContainer">
                <!-- JSで動的に追加 -->
            </div>
        </div>
      </div>
    </div>

    <!-- Bustarain (Content) -->
    <div id="bustarain-container">
        <div class="sub-tab-menu">
            <button class="sub-tab-btn active" onclick="switchSubTab('train-content')"><i class="fas fa-train"></i> Train</button>
            <button class="sub-tab-btn" onclick="switchSubTab('bus-content')"><i class="fas fa-bus"></i> BUS</button>
            <button class="sub-tab-btn" onclick="switchSubTab('other-content')"><i class="fas fa-info-circle"></i> その他</button>
        </div>
        
        <!-- Train Content -->
        <div id="train-content" class="sub-tab-content">
            <div class="accordion-item" data-id="tr-1" data-title="和田岬">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>和田岬</span>
                    <!-- お気に入りボタン挿入位置 -->
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="train/wadmisaki-train.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="tr-2" data-title="帰）板宿新長田経由海岸線">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>帰）板宿新長田経由海岸線</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="train/itayado-train.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="tr-3" data-title="板宿駅（山陽電車）">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>板宿駅（山陽電車）</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="train/Itayado-sannyou.html"></iframe>
                </div>
            </div>
        </div>
        
        <!-- Bus Content -->
        <div id="bus-content" class="sub-tab-content hidden">
            <div class="accordion-item" data-id="bs-1" data-title="バスロケーション">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>バスロケーション</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="bus/Buslocation.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="bs-2" data-title="行き・帰り（今出在家 ⇔ 鷹取団地）">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>行き・帰り（今出在家 ⇔ 鷹取団地）</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="bus/iki-kaeri.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="bs-3" data-title="今出在家">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>今出在家</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="bus/imadezaike.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="bs-4" data-title="夢野町3丁目">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>夢野町3丁目</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="bus/yumeno3.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="bs-5" data-title="高取団地前">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>高取団地前</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="bus/takatoridantimae.html"></iframe>
                </div>
            </div>
            <div class="accordion-item" data-id="bs-6" data-title="板宿駅">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>板宿駅</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="bus/Itayado-bus.html"></iframe>
                </div>
            </div>
        </div>

        <!-- Other Content -->
        <div id="other-content" class="sub-tab-content hidden">
            <div class="accordion-item" data-id="ot-1" data-title="イベント情報">
                <!-- 直接iframeのパターンもアコーディオンに入れるか、そのまま表示するか。元のHTMLではiframe直書きでしたが、お気に入り機能をつけるためアコーディオン化しています -->
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>ノエビアスタジアム イベント情報</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="accordion-content">
                    <iframe class="accordion-iframe" data-src="https://www.noevir-stadium.jp/event/"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Option -->
    <div id="option-container">
        <h3 class="section-title">設定 (Option)</h3>
        <div class="option-card">
            <h4><i class="fas fa-info-circle"></i> アプリ情報</h4>
            <p>Link First: 1.0.2</p>
        </div>
    </div>

</div>

<!-- ▼▼▼ JavaScript ▼▼▼ -->
<script src="script.js"></script>
</body>
</html>
