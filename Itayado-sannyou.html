<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>姫路方面電車時刻表</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .timetable-board {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .top-info {
            background: #f0f0f0;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            color: #666;
        }
        
        .current-date-time {
            font-weight: bold;
        }
        
        .diagram-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .diagram-circles {
            display: flex;
            gap: 5px;
        }
        
        .diagram-circle {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }
        
        .diagram-circle.active {
            background: #f4a261;
        }
        
        .header {
            background: #f4a261;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            font-size: 28px;
            font-weight: bold;
        }
        
        .station-name {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }
        
        .direction {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }
        
        .train-row {
            display: flex;
            align-items: center;
            padding: 25px 30px;
            background: #e0e0e0;
            border-bottom: 3px solid #ccc;
            font-size: 24px;
        }
        
        .train-row.passed {
            background: #ffebee;
            color: #666;
        }
        
        .train-type {
            background: #666;
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            margin-right: 40px;
        }
        
        .train-type.express {
            background: #dc2626;
        }
        
        .train-type.passed {
            background: #999;
        }
        
        .train-time {
            color: white;
            font-size: 48px;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .train-time.passed {
            color: #666;
            text-shadow: none;
        }
        
        .passed-status {
            margin-left: 20px;
            color: #d32f2f;
            font-size: 18px;
            font-weight: bold;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #ddd;
        }
        
        .time-input {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 0 10px;
        }
        
        .auto-schedule-info {
            font-size: 14px;
            color: #28a745;
            margin-top: 10px;
            font-weight: bold;
        }
        
        @media (max-width: 600px) {
            .top-info {
                flex-direction: column;
                gap: 5px;
                padding: 10px 15px;
            }
            
            .header {
                font-size: 20px;
                padding: 15px;
            }
            
            .station-name, .direction {
                font-size: 14px;
            }
            
            .train-row {
                padding: 15px 10px;
                flex-direction: row;
                justify-content: flex-start;
                align-items: center;
                font-size: 18px;
            }
            
            .train-type {
                margin-right: 15px;
                margin-bottom: 0;
                padding: 8px 12px;
                font-size: 14px;
                min-width: 60px;
                flex-shrink: 0;
            }
            
            .train-time {
                font-size: 28px;
                flex-grow: 1;
            }
            
            .passed-status {
                margin-left: 10px;
                margin-top: 0;
                font-size: 14px;
                flex-shrink: 0;
            }
            
            .controls {
                padding: 15px;
            }
            
            .time-input {
                width: 120px;
                margin: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="timetable-board">
        <div class="top-info">
            <div class="current-date-time" id="currentDateTime">0000/00/00(日) 現在時刻00:00</div>
            <div class="diagram-indicator">
                <div class="diagram-circles">
                    <div class="diagram-circle" id="weekdayCircle"></div>
                    <div class="diagram-circle" id="holidayCircle"></div>
                </div>
                <div id="diagramLabel">ダイヤ</div>
            </div>
        </div>
        
        <div class="header">
            <div class="station-name">山陽電車</div>
            <div>板宿駅</div>
            <div class="direction">姫路方面</div>
        </div>
        
        <div class="train-row" id="firstTrainRow">
            <div class="train-type" id="firstTrainType">普通</div>
            <div class="train-time" id="firstTrainTime">00：00</div>
            <div class="passed-status" id="firstPassedStatus"></div>
        </div>
        
        <div class="train-row" id="secondTrainRow">
            <div class="train-type express" id="secondTrainType">直特</div>
            <div class="train-time" id="secondTrainTime">00：00</div>
            <div class="passed-status" id="secondPassedStatus"></div>
        </div>
        
        <div class="train-row" id="thirdTrainRow">
            <div class="train-type" id="thirdTrainType">普通</div>
            <div class="train-time" id="thirdTrainTime">00：00</div>
            <div class="passed-status" id="thirdPassedStatus"></div>
        </div>
        
        <div class="controls">
            <input type="time" class="time-input" id="timeInput" placeholder="時間指定">
            <div class="auto-schedule-info" id="autoScheduleInfo"></div>
        </div>
    </div>

    <script>
        // 時刻表データ
        const timetable = {
            weekday: {
                普通: {
                    5: [23, 37, 45],
                    6: [0, 14, 28, 41, 54],
                    7: [6, 20, 33, 46, 57],
                    8: [10, 20, 23, 34, 38, 41, 50, 54],
                    9: [2, 6, 11, 23, 37, 45, 49, 52],
                    10: [7, 23, 38, 49, 52],
                    11: [7, 23, 37, 53],
                    12: [7, 23, 37, 53],
                    13: [7, 23, 37, 53],
                    14: [7, 23, 37, 53],
                    15: [7, 23, 37, 53],
                    16: [7, 24, 37, 51],
                    17: [4, 17, 29, 43, 55],
                    18: [7, 21, 32, 42, 51, 56],
                    19: [10, 19, 33, 43, 47],
                    20: [0, 12, 21, 25, 41, 55],
                    21: [7, 20, 36, 48, 52],
                    22: [9, 28, 51],
                    23: [16, 47, 54],
                    0: [16]
                },
                直通特急: {
                    5: [35, 49],
                    6: [4, 18, 32, 45, 58],
                    7: [11, 25, 38, 50],
                    8: [3, 15, 29, 44],
                    9: [0, 15, 30, 43],
                    10: [0, 15, 30, 45],
                    11: [0, 15, 30, 45],
                    12: [0, 15, 30, 45],
                    13: [0, 15, 30, 45],
                    14: [0, 15, 30, 45],
                    15: [0, 15, 30, 45],
                    16: [0, 15, 30, 45, 57],
                    17: [8, 21, 35, 48, 59],
                    18: [12, 26, 38, 49],
                    19: [2, 14, 26, 38, 52],
                    20: [5, 17, 30, 46],
                    21: [0, 13, 27, 42, 58],
                    22: [14, 33, 57],
                    23: [21],
                    0: []
                }
            },
            holiday: {
                普通: {
                    5: [23, 38, 45, 59],
                    6: [13, 26, 41, 54],
                    7: [9, 24, 38, 55],
                    8: [10, 19, 25, 35, 39, 52],
                    9: [0, 4, 17, 20, 32, 47],
                    10: [2, 17, 32, 47],
                    11: [2, 17, 32, 47],
                    12: [2, 17, 32, 47],
                    13: [2, 17, 32, 47],
                    14: [2, 17, 32, 47],
                    15: [2, 17, 32, 47],
                    16: [2, 17, 32, 47],
                    17: [2, 17, 34, 49],
                    18: [4, 17, 34, 49],
                    19: [5, 17, 34, 49],
                    20: [6, 17, 33, 49],
                    21: [6, 20, 32, 48, 53],
                    22: [10, 28, 51],
                    23: [16, 47, 54],
                    0: [16]
                },
                直通特急: {
                    5: [50],
                    6: [4, 18, 32, 45],
                    7: [0, 15, 29, 44, 59],
                    8: [15, 29, 44, 56],
                    9: [9, 25, 40],
                    10: [10, 25, 40, 55],
                    11: [10, 25, 40, 55],
                    12: [10, 25, 40, 55],
                    13: [10, 25, 40, 55],
                    14: [10, 25, 40, 55],
                    15: [10, 25, 40, 55],
                    16: [10, 25, 40, 55],
                    17: [10, 25, 40, 55],
                    18: [10, 25, 40, 55],
                    19: [10, 25, 40, 56],
                    20: [10, 25, 40, 57],
                    21: [11, 24, 38, 58],
                    22: [14, 33, 57],
                    23: [21],
                    0: []
                }
            }
        };

        let currentDay = 'weekday';

        function getDayType(date = new Date()) {
            const dayOfWeek = date.getDay();
            return (dayOfWeek === 0 || dayOfWeek === 6) ? 'holiday' : 'weekday';
        }

        function updateCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const dayNames = ['日', '月', '火', '水', '木', '金', '土'];
            const dayName = dayNames[now.getDay()];
            const timeString = now.toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('currentDateTime').textContent = 
                `${year}/${month}/${date}(${dayName}) 現在時刻${timeString}`;
            
            const autoDayType = getDayType(now);
            if (currentDay !== autoDayType) {
                currentDay = autoDayType;
                updateTrains();
            }
        }

        function updateDiagramIndicator() {
            const weekdayCircle = document.getElementById('weekdayCircle');
            const holidayCircle = document.getElementById('holidayCircle');
            
            weekdayCircle.classList.toggle('active', currentDay === 'weekday');
            holidayCircle.classList.toggle('active', currentDay === 'holiday');
        }

        function updateAutoScheduleInfo() {
            const info = document.getElementById('autoScheduleInfo');
            const dayTypeText = currentDay === 'weekday' ? '平日' : '休日';
            info.textContent = `自動選択中: ${dayTypeText}ダイヤ`;
            info.style.display = 'block';
        }

        function isTimePassed(hour, minute, currentTime) {
            const trainTime = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate(), hour, minute);
            const diffMs = currentTime - trainTime;
            return diffMs > 0 && diffMs <= 2 * 60 * 1000; // 0-2分の範囲
        }

        function getNextTrains(targetTime = null) {
            const now = targetTime || new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTimeInMinutes = hour * 60 + minute;

            const allTrains = [];
            const schedule = timetable[currentDay];

            // 当日の電車のみを対象とする
            for (const trainType in schedule) {
                for (const h in schedule[trainType]) {
                    const hourNum = parseInt(h);
                    const minutes = schedule[trainType][h];
                    
                    for (const m of minutes) {
                        let trainTimeInMinutes = hourNum * 60 + m;
                        
                        // 深夜の電車（翌日0時台など）は当日のものとして扱う
                        if (hourNum < 5) {
                            trainTimeInMinutes += 24 * 60;
                        }
                        
                        allTrains.push({
                            type: trainType,
                            hour: hourNum,
                            minute: m,
                            timeInMinutes: trainTimeInMinutes,
                            isPassed: isTimePassed(hourNum < 5 ? hourNum + 24 : hourNum, m, now)
                        });
                    }
                }
            }

            // 時刻順にソート
            allTrains.sort((a, b) => a.timeInMinutes - b.timeInMinutes);

            // 現在時刻以降の電車または定刻を過ぎて2分以内の電車を取得
            const upcomingTrains = allTrains.filter(train => {
                return train.timeInMinutes > currentTimeInMinutes || train.isPassed;
            });
            
            return upcomingTrains.slice(0, 3);
        }

        function formatTime(hour, minute) {
            return `${hour.toString().padStart(2, '0')}：${minute.toString().padStart(2, '0')}`;
        }

        function getTrainTypeDisplay(type) {
            return type === '直通特急' ? '直特' : '普通';
        }

        function updateTrains() {
            const timeInput = document.getElementById('timeInput');
            let targetTime = null;
            
            if (timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':').map(Number);
                targetTime = new Date();
                targetTime.setHours(hours, minutes, 0, 0);
            }

            const nextTrains = getNextTrains(targetTime);
            
            const trainElements = [
                { row: 'firstTrainRow', type: 'firstTrainType', time: 'firstTrainTime', status: 'firstPassedStatus' },
                { row: 'secondTrainRow', type: 'secondTrainType', time: 'secondTrainTime', status: 'secondPassedStatus' },
                { row: 'thirdTrainRow', type: 'thirdTrainType', time: 'thirdTrainTime', status: 'thirdPassedStatus' }
            ];

            trainElements.forEach((element, index) => {
                const rowElement = document.getElementById(element.row);
                const typeElement = document.getElementById(element.type);
                const timeElement = document.getElementById(element.time);
                const statusElement = document.getElementById(element.status);
                
                if (nextTrains[index]) {
                    const train = nextTrains[index];
                    
                    typeElement.textContent = getTrainTypeDisplay(train.type);
                    timeElement.textContent = formatTime(train.hour, train.minute);
                    
                    if (train.isPassed) {
                        // 定刻を過ぎた電車の表示
                        rowElement.classList.add('passed');
                        typeElement.classList.add('passed');
                        timeElement.classList.add('passed');
                        statusElement.textContent = '定刻を過ぎました';
                        
                        if (train.type === '直通特急') {
                            typeElement.classList.add('express');
                        }
                    } else {
                        // 通常の電車の表示
                        rowElement.classList.remove('passed');
                        typeElement.classList.remove('passed');
                        typeElement.className = train.type === '直通特急' ? 'train-type express' : 'train-type';
                        timeElement.classList.remove('passed');
                        statusElement.textContent = '';
                    }
                } else {
                    // 電車が無い場合
                    rowElement.classList.remove('passed');
                    typeElement.className = 'train-type';
                    typeElement.textContent = '---';
                    timeElement.classList.remove('passed');
                    timeElement.textContent = '--：--';
                    statusElement.textContent = '';
                }
            });

            updateDiagramIndicator();
            updateAutoScheduleInfo();
        }

        document.getElementById('timeInput').addEventListener('change', updateTrains);

        function init() {
            currentDay = getDayType();
            updateCurrentDateTime();
            updateTrains();
        }

        setInterval(() => {
            updateCurrentDateTime();
            if (!document.getElementById('timeInput').value) {
                updateTrains();
            }
        }, 1000);

        init();
    </script>
</body>
</html>
