<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Embed Splits</title>
  <style>
    :root{
      --gap:12px;
      --bg:#434343;
      --card:#1b1b1b;
      --muted:#cccccc99;
    }
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo, sans-serif;
      display:flex; flex-direction:column;
    }
    header{display:flex; align-items:center; gap:12px; padding:12px; background:linear-gradient(180deg,#0f0f0f, #0b0b0b); box-shadow:0 2px 8px #0003}
    h1{font-size:16px; margin:0}
    .controls{margin-left:auto; display:flex; gap:8px; align-items:center}
    button, .toggle{background:transparent; border:1px solid #333; color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer}
    button.primary{background:#2d7cff; border-color:#2d7cff}
    main{flex:1; padding:var(--gap); box-sizing:border-box; display:flex; flex-direction:row; gap:var(--gap)}

    .grid-wrap{flex:1; display:grid; gap:var(--gap); align-content:start; aspect-ratio:16/9;}
    .list-wrap{width:260px; background:#2b2b2b; border-radius:10px; padding:8px; overflow-y:auto;}
    .list-wrap h2{text-align:center; font-size:14px; margin:8px 0;}
    .list-item{background:#3b3b3b; padding:6px 10px; border-radius:8px; margin:4px 0; cursor:pointer; display:flex; justify-content:space-between; align-items:center;}
    .list-item:hover{background:#555;}
    .list-item button{background:transparent; border:0; color:#fff; cursor:pointer;}

    .card{position:relative; background:var(--card); border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; aspect-ratio:16/9;}
    .card iframe{width:100%; height:100%; border:0; display:block}
    .placeholder{width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding:18px; box-sizing:border-box}
    .plus{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px dashed #666}
    .meta{font-size:13px;color:var(--muted); text-align:center}

    .overlay{position:absolute; top:8px; right:8px; display:flex; gap:6px; z-index:2;}
    .icon-btn{background:#0008; border:0; padding:6px 8px; border-radius:8px; cursor:pointer; backdrop-filter:blur(4px); color:#fff;}

    .editor{position:fixed; left:50%; transform:translateX(-50%); bottom:18px; width:min(980px,calc(100% - 40px)); background:#0e0e0e; border:1px solid #222; padding:12px; border-radius:12px; box-shadow:0 8px 30px #0008; display:flex; gap:8px; align-items:center}
    .editor input{flex:1; padding:10px; border-radius:8px; border:1px solid #333; background:#111; color:#fff}
    .small{font-size:13px;color:var(--muted)}

    .fullscreen{position:fixed; top:0; left:0; width:100vw; height:100vh; background:#000; display:flex; align-items:center; justify-content:center; z-index:9999;}
    .fullscreen iframe{width:90%; height:90%; border:0;}

    footer{padding:10px 12px; font-size:13px; color:var(--muted); background:linear-gradient(180deg,#080808,#050505)}

    @media (max-width:700px){ header h1{font-size:14px} .editor{bottom:8px; padding:8px} main{flex-direction:column;} .list-wrap{width:100%; height:200px;} }
  </style>
</head>
<body>
  <header>
    <h1>YouTube Embed Splits</h1>
    <div class="controls">
      <div class="small">レイアウト:</div>
      <button id="btn2" class="toggle">2画面</button>
      <button id="btn4" class="toggle">4画面</button>
      <button id="clear" title="すべてクリア">クリア</button>
    </div>
  </header>

  <main>
    <div id="grid" class="grid-wrap" aria-live="polite"></div>
    <div class="list-wrap">
      <h2>動画リスト</h2>
      <div id="videoList"></div>
    </div>
  </main>

  <div id="editor" class="editor" style="display:none;">
    <div class="small">Slot</div>
    <input id="editorInput" placeholder="YouTubeの共有URL（例: https://youtu.be/abc123 または https://www.youtube.com/watch?v=abc123）" />
    <button id="saveBtn" class="primary">保存</button>
    <button id="cancelBtn">キャンセル</button>
  </div>

  <footer>リンクは自動保存されます。画面比率は16:9です。クリックで拡大できます。</footer>

  <script>
    const STORAGE_KEY = 'yt_grid_links_v1';
    const LAYOUT_KEY = 'yt_grid_layout_v1';

    let layout = parseInt(localStorage.getItem(LAYOUT_KEY)) || 4;
    let links = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    while(links.length < layout) links.push(null);

    const grid = document.getElementById('grid');
    const videoList = document.getElementById('videoList');
    const btn2 = document.getElementById('btn2');
    const btn4 = document.getElementById('btn4');
    const editor = document.getElementById('editor');
    const editorInput = document.getElementById('editorInput');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const clearBtn = document.getElementById('clear');

    let editingIndex = null;

    function parseYouTubeId(url){
      if(!url) return null;
      try{
        if(/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
        const u = new URL(url);
        if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        if(u.hostname.includes('youtube.com')){
          if(u.searchParams.get('v')) return u.searchParams.get('v');
          const parts = u.pathname.split('/');
          const idx = parts.indexOf('embed');
          if(idx >=0 && parts[idx+1]) return parts[idx+1];
        }
      }catch(e){}
      return null;
    }

    function toEmbedUrl(link){
      const id = parseYouTubeId(link);
      return id ? `https://www.youtube.com/embed/${id}?rel=0&autoplay=0` : null;
    }

    function saveAll(){
      links = links.slice(0, layout);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(links));
      localStorage.setItem(LAYOUT_KEY, String(layout));
    }

    function openEditor(index){
      editingIndex = index;
      editor.style.display = 'flex';
      editorInput.value = links[index] || '';
      editorInput.focus();
      editorInput.select();
    }

    function closeEditor(){
      editingIndex = null; editor.style.display = 'none'; editorInput.value = '';
    }

    function setLayout(n){
      layout = n;
      while(links.length < layout) links.push(null);
      renderGrid();
      saveAll();
    }

    function removeLink(index){
      links[index] = null;
      saveAll();
      renderGrid();
    }

    function openFullscreen(link){
      const url = toEmbedUrl(link);
      if(!url) return;
      const div = document.createElement('div');
      div.className = 'fullscreen';
      div.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
      div.addEventListener('click', ()=> div.remove());
      document.body.appendChild(div);
    }

    function renderList(){
      videoList.innerHTML = '';
      for(let i=0;i<30;i++){
        const item = document.createElement('div');
        item.className = 'list-item';
        item.innerHTML = `<span>${i+1}. ${links[i] ? '登録済み' : '空き'}</span>`;
        const btn = document.createElement('button');
        btn.textContent = '表示';
        btn.addEventListener('click', ()=>{
          if(links[i]) openFullscreen(links[i]);
          else openEditor(i);
        });
        item.appendChild(btn);
        videoList.appendChild(item);
      }
    }

    function renderGrid(){
      grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
      grid.style.gridAutoRows = '1fr';

      grid.innerHTML = '';
      for(let i=0;i<layout;i++){
        const card = document.createElement('div');
        card.className = 'card';

        const link = links[i];
        const embed = toEmbedUrl(link);
        if(embed){
          const iframe = document.createElement('iframe');
          iframe.src = embed;
          iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen';
          card.appendChild(iframe);
          card.addEventListener('click', ()=> openFullscreen(link));
        } else {
          const ph = document.createElement('div');
          ph.className = 'placeholder';
          const plus = document.createElement('div'); plus.className='plus'; plus.innerHTML = '<svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
          ph.appendChild(plus);
          const meta = document.createElement('div'); meta.className='meta'; meta.textContent = 'YouTubeリンクを追加';
          ph.appendChild(meta);
          card.appendChild(ph);
          card.addEventListener('click', ()=> openEditor(i));
        }

        const overlay = document.createElement('div'); overlay.className='overlay';
        const editBtn = document.createElement('button'); editBtn.className='icon-btn'; editBtn.innerHTML = '編集';
        editBtn.addEventListener('click',(e)=>{ e.stopPropagation(); openEditor(i); });
        const delBtn = document.createElement('button'); delBtn.className='icon-btn'; delBtn.innerHTML = '削除';
        delBtn.addEventListener('click',(e)=>{ e.stopPropagation(); removeLink(i); });
        overlay.appendChild(editBtn);
        overlay.appendChild(delBtn);
        card.appendChild(overlay);

        grid.appendChild(card);
      }
      btn2.classList.toggle('primary', layout===2);
      btn4.classList.toggle('primary', layout===4);
      renderList();
    }

    saveBtn.addEventListener('click', ()=>{
      const v = editorInput.value.trim();
      if(!v){ links[editingIndex] = null; saveAll(); renderGrid(); closeEditor(); return; }
      const id = parseYouTubeId(v);
      if(!id){ alert('YouTubeのURLまたは動画IDを正しく入れてください。'); return; }
      links[editingIndex] = v;
      saveAll(); renderGrid(); closeEditor();
    });

    editorInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') saveBtn.click();
      if(e.key === 'Escape') cancelBtn.click();
    });

    cancelBtn.addEventListener('click', ()=> closeEditor());
    btn2.addEventListener('click', ()=> setLayout(2));
    btn4.addEventListener('click', ()=> setLayout(4));
    clearBtn.addEventListener('click', ()=>{
      if(confirm('すべてのリンクを消去しますか？')){
        links = Array(layout).fill(null);
        saveAll(); renderGrid();
      }
    });

    renderGrid();
  </script>
</body>
</html>
